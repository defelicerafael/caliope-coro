<div class="web-padding">
    <h4 mat-dialog-title>Editar datos</h4>
    
    @if(empezarFormulario()){ 
      <form [formGroup]="EditFormGroup" (ngSubmit)="onSubmit(EditFormGroup)" ngNativeValidate class="mt-3">
        @for(i of arrayEdits; track i.n){
          @if(i.t==='select'){
            <p>
                <mat-form-field appearance="outline" class="w-100 pt-1">
                  <mat-label>{{i.n |  formatLabel}}</mat-label>
                  <mat-select [formControlName]="i.n" required>
                      @for (p of dynamicProperties[i.n + '$'] | async; track p.id) {
                          <mat-option [value]="p?.[i.d]">{{p?.[i.d]}}</mat-option>
                      }
                  </mat-select>
                </mat-form-field>
            </p>
          }
  
          @if(i.t==='selectBoolean'){
            <mat-form-field appearance="outline" class="w-100 pt-1">
              <mat-label>{{i.n |  formatLabel}}</mat-label>
              <mat-select [formControlName]="i.n" required>
                <mat-option value="si">Si</mat-option>
                <mat-option value="no">No</mat-option>
              </mat-select>
            </mat-form-field>
          }
  
          @if(i.t === 'selectM'){
            <mat-form-field appearance="outline" class="w-100 pt-1">
              <mat-label>{{ i.n | formatLabel }}</mat-label>
              <mat-select [formControlName]="i.n" multiple>
                @for (p of dynamicProperties[i.n + '$'] | async; track p.id) {
                  <mat-option value="[{{p?.nombre}}]">{{ p?.nombre }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          }
  
          @if(i.t==='text'){
            <p>
                <mat-form-field class="w-100 mt-2" appearance="outline"> 
                <mat-label class="texto">{{i.n |  formatLabel}}</mat-label>  
                <input matInput [type]="i.t"  [name]="i.n" [id]="i.n" [formControlName]="i.n" placeholder=""> 
                @if(EditFormGroup.get(i.n)?.invalid && (EditFormGroup.get(i.n)?.dirty || EditFormGroup.get(i.n)?.touched)){
                    @if(EditFormGroup.get(i.n)?.errors?.['required']){
                    <mat-hint>
                        Falta este dato: {{i.n}}
                    </mat-hint>
                    }  
                    @if(EditFormGroup.get(i.n)?.errors?.['minlength']){
                    <mat-hint>
                        Falta texto en {{i.n}}
                    </mat-hint>
                    }
                }
                </mat-form-field>
            </p>
          }

          @if(i.t==='email'){
            <p>
                <mat-form-field class="w-100 mt-2" appearance="outline"> 
                <mat-label class="texto">{{i.n |  formatLabel}}</mat-label>  
                <input matInput [type]="i.t"  [name]="i.n" [id]="i.n" [formControlName]="i.n" placeholder=""> 
                @if(EditFormGroup.get(i.n)?.invalid && (EditFormGroup.get(i.n)?.dirty || EditFormGroup.get(i.n)?.touched)){
                    @if(EditFormGroup.get(i.n)?.errors?.['required']){
                    <mat-hint>
                        Falta este dato: {{i.n}}
                    </mat-hint>
                    }  
                    @if(EditFormGroup.get(i.n)?.errors?.['minlength']){
                    <mat-hint>
                        Falta texto en {{i.n}}
                    </mat-hint>
                    }
                }
                </mat-form-field>
            </p>
          }

          @if(i.t==='password'){
            <p>
                <mat-form-field class="w-100 mt-2" appearance="outline"> 
                <mat-label class="texto">{{i.n |  formatLabel}}</mat-label>  
                <input matInput [type]="i.t"  [name]="i.n" [id]="i.n" [formControlName]="i.n" placeholder=""> 
                @if(EditFormGroup.get(i.n)?.invalid && (EditFormGroup.get(i.n)?.dirty || EditFormGroup.get(i.n)?.touched)){
                    @if(EditFormGroup.get(i.n)?.errors?.['required']){
                    <mat-hint>
                        Falta este dato: {{i.n}}
                    </mat-hint>
                    }  
                    @if(EditFormGroup.get(i.n)?.errors?.['minlength']){
                    <mat-hint>
                        Falta texto en {{i.n}}
                    </mat-hint>
                    }
                }
                </mat-form-field>
            </p>
          }
  
          @if(i.t==='date'){
            <mat-form-field class="w-100 mt-2" appearance="outline">
              <mat-label class="texto">{{i.n |  formatLabel}}</mat-label>  
              <input matInput [matDatepicker]="picker" [name]="i.n" [id]="i.n" [formControlName]="i.n" >
              <mat-hint>DD/MM/YYYY</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              @if(EditFormGroup.get(i.n)?.invalid && (EditFormGroup.get(i.n)?.dirty || EditFormGroup.get(i.n)?.touched)){
                @if(EditFormGroup.get(i.n)?.errors?.['required']){
                <mat-hint>
                    Falta este dato: {{i.n}}
                </mat-hint>
                }  
             }
            </mat-form-field>
          }

          @if(i.t==='number'){
            <mat-form-field class="w-100 mt-2" appearance="outline"> 
            <mat-label class="texto">{{i.n |  formatLabel}}</mat-label>  
            <input matInput [type]="i.t"  [name]="i.n" [id]="i.n" [formControlName]="i.n" placeholder=""> 
              @if(EditFormGroup.get(i.n)?.invalid && (EditFormGroup.get(i.n)?.dirty || EditFormGroup.get(i.n)?.touched)){
                @if(EditFormGroup.get(i.n)?.errors?.['required']){
                  <mat-hint>
                    Falta este dato: {{i.n}}
                  </mat-hint>
                }  
                @if(EditFormGroup.get(i.n)?.errors?.['minlength']){
                  <mat-hint>
                    Falta texto en {{i.n}}
                  </mat-hint>
                }
              }
            </mat-form-field>
          }
  
          @if(i.t==='area'){
            <mat-form-field class="w-100 mt-2" appearance="outline"> 
              <mat-label class="texto">{{i.n |  formatLabel }}</mat-label>  
              <textarea matInput [type]="i.t"  [name]="i.n" [id]="i.n" [formControlName]="i.n" placeholder=""></textarea> 
            </mat-form-field>
          }
          
          @if(i.t === 'check'){
            <!--
              <mat-button-toggle-group name="fontStyle" aria-label="Font Style">
                <mat-button-toggle (click)="runCheck(i.n)">
                  <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#5f6368"><path d="m222-209.33-142-142L126.67-398l95 94.33 176-176L444.33-432 222-209.33Zm0-320-142-142L126.67-718l95 94.33 176-176L444.33-752 222-529.33Zm298 242.66v-66.66h360v66.66H520Zm0-320v-66.66h360v66.66H520Z"/></svg>
                </mat-button-toggle>
                <mat-button-toggle (click)="resetForm()">
                  <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#5f6368"><path d="M186.67-120q-27.5 0-47.09-19.58Q120-159.17 120-186.67v-586.66q0-27.5 19.58-47.09Q159.17-840 186.67-840h586.66q12 0 22 4.5t17 10.83l-54 54v-2.66H186.67v586.66h586.66V-504L840-570.67v384q0 27.5-19.58 47.09Q800.83-120 773.33-120H186.67ZM461-285.33 237.67-508.67l46.66-46.66L461-378.67l377-377 47 46.34-424 424Z"/></svg>
                </mat-button-toggle>
              </mat-button-toggle-group>
            -->

              <h4>{{i.n | formatLabel }}</h4>
              <ul [formArrayName]="'check'" class="columns">
                @for (p of dynamicProperties[i.n + '$'] | async; track p.id; let a = $index) {
                  <li>
                    <mat-checkbox [formControlName]="a">
                      {{p.nombre}}
                    </mat-checkbox>
                  </li>
                }
              </ul>
          }
         <!-- @if(i.t==='acordeon'){
            <h4 class="mt-2 pt-2"><b>Zona de atenci√≥n:</b><i>{{this.data.datosFormulario[0][i.b]}}</i></h4>
                <mat-accordion>
                @for (p of acordeon2$['base'] | async; track p.id) {
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title> {{p.nombre}} </mat-panel-title>
                    </mat-expansion-panel-header>
                    <ul class="columns" [formArrayName]="'check'">
                      @for (localidades of dynamicProperties['nombre'] | async; track localidades.id; let a = $index) {
                        @if(localidades.id_zona_de_atencion === p.id ){    
                          <li>
                              <mat-checkbox [formControlName]="a">
                                  {{localidades.nombre}} {{localidades.descripcion}}
                              </mat-checkbox>
                          </li>
                        }
                      }
                    </ul>
                  </mat-expansion-panel>
                  }
                </mat-accordion>
              }-->
  
            }
      </form>
    }
      <button mat-flat-button (click)="onSubmit(EditFormGroup)" color="primary">{{textoBoton}}</button>
  </div>
